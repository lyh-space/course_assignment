第九周没有上机课，本次 assignment 为张老师留的课后练习题。  
以下代码是我自己的做法，能够实现要求的代码不唯一，此代码与老师给的答案思路有所不同。  
## 一、背景：

在求解温度场、流场、变形场以及电磁场等问题时，通常需要将问题的作用域分割成简单的三角形或四边形（二维问题），或者四面体或六面体（三维问题）。在求解时，需要访问这些基本单元的顶点坐标以及单元的属性（如二维单元的面积或三维单元的体积）

<!--more-->

## 二、任务：

1. 定义一种复合数据类型，描述二维及三维顶点（Node）的位置。
2. 定义一种复合数据类型，统一描述三角形（TRI）、四边形（QUAD）、四面体（TET）和六面体(HEX）这四种类型的单元。
3. 利用已定义的数据类型，定义数组，存储下表中的节点和单元 
4. 定义面积计算函数，计算三角形或四边形单元的面积。输入：单元；输出：面积。
5. 统计上页单元列表的总面积 。

节点：

| 节点编号 |  x    |   y   |
| :------: | :--: | :--: |
| 1 | 20 | 15 |
| 2 | -15 | 15 |
| 3 | 20 | -16.25 |
| 4 | -15 | -16.25 |
| 5 | -36.2392235 | 22.0970879 |
| 6 | -41.25 | -10 |
| 7 | -22.0970879 | -36.2392235 |
| 8 | 10 | -41.25 |
| 9 | 36.2392235 | -22.0970879 |
| 10 | 41.25 | 10 |
| 11 | 22.0970879 | 36.2392235 |
| 12 | -10 | 41.25 |

三角形单元：

| 单元编号 | 节点1编号 | 节点2编号 | 节点3编号 |
| -------- | --------- | --------- | --------- |
| 1        | 10        | 11        | 1         |
| 2        | 8         | 9         | 3         |
| 3        | 6         | 7         | 4         |
| 4        | 12        | 5         | 2         |

四边形单元：

| 单元编号 | 节点1编号 | 节点2编号 | 节点3编号 | 节点4编号 |
| :------: | :-------: | :-------: | :-------: | :-------: |
|    5     |    12     |     2     |     1     |    11     |
|    6     |     2     |     5     |     6     |     4     |
|    7     |     4     |     7     |     8     |     3     |
|    8     |     3     |     9     |    10     |     1     |

## 三、分析

本任务大致分为三部分：定义数据类型、输入数据、计算

### （一）定义数据类型

本任务的最终目标是描述多个不同种类的单元，其中每个单元用单元编号进行标识，包含有若干个节点，每个节点用节点编号进行标识，包含若干个坐标值。

整体思路为：

用结构体描述不同种类的单元，定义一个结构体类型数组存储所有的单元

用联合体描述二维或三维节点，定义一个联合体类型数组存储所有的节点

结构体中每种单元分别用一个数组描述其需要的节点

联合体中每种节点分别用一个数组描述其需要的坐标

代码为：

```cpp
//用联合体描述二维和三维节点
union Node
{
	//数组用于储存坐标值
	double node_2d[2]; //二维节点需要(x,y)两个值
	double node_3d[3]; //三维节点需要(x,y,z)三个值
};

//声明用以存储节点的数组
Node node_point[12];

//用结构体描述四种几何单元
struct Geometry
{
	//数组用于储存节点编号
	int tri[3]; //三角形 需要三个顶点
	int quad[4]; //四边形 需要四个顶点
	int tet[4]; //四面体 需要四个顶点
	int hex[8]; //六面体 需要八个顶点
};

//声明用以存储单元的数组
Geometry unit[8];
```

### （二）输入数据

输入数据部分较为简单，可以直接为两个数组中每个元素一一进行赋值，也可以先把所有要输入的数据存到一个数组里，然后再对应输入到不同类型的数组中。

```cpp
int main()
{
	//录入节点数据
    //定义两个数组分别存放x、y的值
	double x[12] = {20., -15., 20., -15., -36.2392235, -41.25, \
	-22.0970879, 10., 36.2392235, 41.25, 22.0970879, -10.,};
	double y[12] = {15., 15., -16.25, -16.25, 22.0970879, -10., \
	-36.2392235, -41.25, -22.0970879, 10., 36.2392235, 41.25};
    //将x、y对应输入节点数组中
	for (int i = 0; i < 12; i++)
	{
		node_point[i].node_2d[0] = x[i];
		node_point[i].node_2d[1] = y[i];
	}

	//录入单元数据
    //定义一个二维数组存储每个单元的节点编号
	int unit_data[8][4]={
		{10, 11, 1},
		{8, 9, 3},
		{6, 7, 4},
		{12, 5, 2},
		{12, 2, 1, 11},
		{2, 5, 6, 4},
		{4, 7, 8, 3},
		{3, 9, 10, 1}
	};
    //输入三角形单元的节点编号
	for (int i = 0; i <4; i++) 
	{
		for (int j = 0; j < 3; j++)
		{
			unit[i].tri[j] = unit_data[i][j];
		}
	}
    //输入四边形单元的节点编号
	for (int i = 4; i <8; i++) 
	{
		for (int j = 0; j < 4; j++)
		{
			unit[i].quad[j] = unit_data[i][j];
		}
	}
}
```

### （三）计算

计算函数要求输入的是单元编号，输出的是单元的面积，因此其中需要我们根据单元编号判断不同的单元类型，并使用相应的面积计算方法。

在本任务中实际只需要计算三角形和平面四边形两种图形的面积，其中四边形的面积又可以分为两个三角形进行计算，因此本函数的关键是计算三角形的面积。

由于函数的输入值是单元编号，我们可以获取到的是单元的各个节点及其坐标，因此首先要根据两点的坐标求出边长，然后再利用海伦公式求三角形面积。

```cpp
//定义边长计算函数  根据输入的节点编号计算对应的边长
//输入两个节点a、b
double length(int a, int b)
{
    //分别读取a、b两点的坐标
	double x1 = node_point[a-1].node_2d[0];
	double y1 = node_point[a-1].node_2d[1];
	double x2 = node_point[b-1].node_2d[0];
	double y2 = node_point[b-1].node_2d[1];
    //根据两点的坐标求边长
	double l = sqrt(pow((x1 - x2), 2) + pow((y1 - y2), 2));

	return l;
}
```

```cpp
//定义三角形面积计算函数
double tri_area(double a, double b, double c)
{
	double S = 1./4. * sqrt((a + b + c) * (a + b - c) * (a + c - b) * (b + c - a));
	return S;
}
```

```cpp
//定义面积计算函数
double area(int n)
{
	double S;
	if (n > 0 && n < 5) //判断为计算三角形面积
	{
		//计算边长
		double a = length(unit[n-1].tri[0], unit[n-1].tri[1]);
		double b = length(unit[n-1].tri[0], unit[n-1].tri[2]);
		double c = length(unit[n-1].tri[1], unit[n-1].tri[2]);
		//计算面积
		S = tri_area(a, b, c);
	}
	else if (n > 4 && n < 9) //判断为计算四边形面积
	{
		//计算边长
		//此处认为四边形单元的四个节点是按照1234的顺序给的
		double a = length(unit[n-1].quad[0], unit[n-1].quad[1]);
		double b = length(unit[n-1].quad[1], unit[n-1].quad[2]);
		double c = length(unit[n-1].quad[2], unit[n-1].quad[3]);
		double d = length(unit[n-1].quad[3], unit[n-1].quad[0]);
		//将四边形面积分为两个三角形面积计算
		S = tri_area(a, c, b) + tri_area(a, c, d);
	}
	else //输入的单元编号不正确时抛出异常
	{
		throw "Wrong unit number input!";
	}
	return S;
}
```

至此，面积计算函数的定义已经完成，下面是其在main函数中的使用：

```cpp
int main()
{
	//数据输入部分省略
    //……

	//面积计算函数的使用与异常处理
	int n; //单元编号
	cout << "请输入要计算面积的单元编号" << endl;
	cin >> n;
	try
	{
		cout << "单元编号为" << n << "的图形面积为" << area(n) << endl;
	}
	catch (const char* msg)
	{
		cout << msg << endl;
		cout << "请输入1~8的整数" << endl;
		cin >> n;
		cout << "单元编号为" << n << "的图形面积为" << area(n) << endl;
	}

	//统计单元列表的总面积
	double sum = 0;
	for (int i = 1; i < 9; i++)
	{
		sum += area(i);
	}
	cout << "单元列表的总面积为" << sum << endl;

	return 0;
}
```
